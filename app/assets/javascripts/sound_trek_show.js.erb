var map,
    currentPositionMarker,
    mapCenter = new google.maps.LatLng(41.8762180, -87.6531470),
    map;


function createNewSoundTrek(position) {
  var latitude = position.coords.latitude
  var longitude = position.coords.longitude

  $("#new-sound-trek-container").on("submit", "#new-sound-trek-form", function(event) {
    event.preventDefault();

    var title = $(this).find($("#sound_trek_title")).val();
    var description = $(this).find($("#sound_trek_description")).val();
    var playlist = $(this).find($("#sound_trek_playlist")).val();
    var trekker_id = $(this).find($("#sound_trek_trekker_id")).val();

    $.ajax({
      url: '/sound_treks',
      type: 'POST',
      data: {sound_trek:{title: title, description: description, playlist: playlist, trekker_id: trekker_id, latitude: latitude, longitude: longitude}}
    })
    .done(function(response) {
      console.log("success");
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(response.latitude, response[i].longitude),
        icon: soundTrekIcon,
        map: map,
        soundtrekId: response[i].id
      });
    }
      window.location.href = "/sound_treks/" + response
    })
    .fail(function() {
      $("#new-sound-trek-container").html("<div id='not-logged-in'>SoundTrek not created!<div>");
      console.log("error");
    });
  });
};

for (var i = 0; i < response.length; i++){
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(response[i].latitude, response[i].longitude),
        icon: soundTrekIcon,
        map: map,
        soundtrekId: response[i].id
      });
       allMarkers.push(marker);
    }
    for (var x = 0; x < allMarkers.length; x++){
      clickMarker(allMarkers[x]);
    }
  });

function setMarkerPosition(marker, position) {
  marker.setPosition(
    new google.maps.LatLng(
      position.coords.latitude,
      position.coords.longitude)
  );
}

